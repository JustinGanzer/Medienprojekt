function updateSponge(){isHitted&&(spongeUpBool=!0);var t=Math.sin(sprungdauer/sprungMax*(Math.PI/2));sprungdauer>sprungMax&&(t=sprungdauer/10),t=15*t;var e=t;t=t*(currentPlatformX-300)/960,spongeUpBool?(spongeY+=e,sprungdauer++):(spongeY-=t,updatePlatforms(e*boost),punktzahl+=t*boost,sprungdauer--,sprungdauer<=1&&(spongeUpBool=!0,sprungdauer=1)),boost>1?boost-=currentBoost/sprungMax:boost=1,spongeX+=gamma,spongeX+Player.WIDTH/2>NJ.WIDTH&&(spongeX=Player.WIDTH/2*-1),spongeX<Player.WIDTH/2*-1&&(spongeX=NJ.WIDTH-Player.WIDTH/2)}function updatePlatforms(t){NJ.entities.forEach(function(e){e.y=e.y+t,e.img.x=e.img.y+t})}function generatePlatforms(){for(;NJ.entities.length<50;){var t=NJ.entities[NJ.entities.length-1],e=-Math.floor(150*Math.random()+1)-50+t.y,n=Math.floor(540*Math.random()+1);if(!generateEnemy(n,e)){var i=Math.floor(100*Math.random()+1);i=i>90?2:1;var r=new Platform(n,e,i);NJ.entities.push(r)}}}function generateEnemy(t,e){var n=Math.floor(100*Math.random()+1);if(!(NJ.entities[NJ.entities.length-1]instanceof Platform))return!1;if(n>91){var i=new Enemy(t,e,1);return NJ.entities.push(i),!0}if(n>90){var i=new Enemy(t,e,2);return NJ.entities.push(i),!0}}function Enemy(t,e,n){this.img=new Image,this.xOffset=75,this.x=t,this.y=e,this.img.x=t,this.img.y=e,this.img.src="./pictures/Enemy"+n+".png";var i=this.img;this.img.onload=function(){},this.draw=function(){NJ.ctx.drawImage(this.img,this.x,this.y-i.y)},this.check=function(){if(this.y>960){var t=NJ.entities.indexOf(this);NJ.entities.splice(t,1)}},this.isHit=function(){(spongeX>=this.x&&spongeX<=this.x+this.xOffset||spongeX+Player.WIDTH>=this.x&&spongeX+Player.WIDTH<=this.x+this.xOffset)&&spongeY+Player.HEIGHT>=this.y&&spongeY+Player.HEIGHT<=this.y+55&&(console.log(isHitted),isHitted=!0)}}function Platform(t,e,n){switch(this.img=new Image,this.xOffset=100,this.x=t,this.y=e,this.img.x=t,this.img.y=e,this.img.src="./pictures/Platform"+n+".png",this.boost=1,n){case 1:this.boost=1;break;case 2:this.boost=4;break;case 3:this.boost=0}this.img;this.img.onload=function(){},this.draw=function(){NJ.ctx.drawImage(this.img,this.x,this.y)},this.check=function(){if(this.y>960){var t=NJ.entities.indexOf(this);NJ.entities.splice(t,1)}},this.isHit=function(){if((spongeX>=this.x&&spongeX<=this.x+this.xOffset||spongeX+Player.WIDTH>=this.x&&spongeX+Player.WIDTH<=this.x+this.xOffset)&&spongeY+Player.HEIGHT>=this.y&&spongeY+Player.HEIGHT<=this.y+55){SOUND.platformsound.play(),spongeUpNr=345,sprungdauer=sprungMax,currentPlatformX=this.y,spongeUpBool=!1,boost=this.boost,currentBoost=1;var t=NJ.entities.indexOf(this);NJ.entities.splice(t,1)}}}function start(){spongeX=NJ.WIDTH/4,currentPlatformX=NJ.WIDTH/4,spongeY=500,spongeUpBool=!0,isHitted=!1,spongeUpNr=0,sprungdauer=sprungMax/2,punktzahl=0,currentBoost=0,boost=1,Player.IMAGE.onload=function(){NJ.ctx.drawImage(Player.IMAGE,spongeX,spongeY,Player.HEIGHT,Player.WIDTH)},SOUND.audio2.play();var t=new Platform(150,750,1),e=new Platform(300,750,1),n=new Platform(225,450,1);NJ.entities.push(t,e,n),currentScreen=gamescreen,NJ.loop()}function stop(){punktzahl=parseInt(punktzahl),alert("Verloren! Punktzahl: "+punktzahl),NJ.entities=[],NJ.render(),isPaused=!0,currentScreen=menu,SOUND.audio2.pause(),menu.draw()}function charselection(){SOUND.audio2.pause();var t=new Chars;currentScreen=t,NJ.Draw.clear(),currentScreen.draw()}function gameover(){if(requestId){window.cancelAnimationFrame(requestId),requestId=void 0,currentScreen=null,NJ.Draw.clear();var t=new Image;t.src="./pictures/topf.png",t.onload=function(){};var e=new Image;e.src="./pictures/gameover.png",e.onload=function(){};var n=function(){NJ.ctx.drawImage(t,40,700),NJ.ctx.drawImage(e,0,200)},i=250,r=50;n(),NJ.ctx.drawImage(Player.IMAGE,i,r,Player.HEIGHT,Player.WIDTH),this.loop=function(){800>r?(r+=20,NJ.Draw.clear(),n(),NJ.ctx.drawImage(Player.IMAGE,i,r,Player.HEIGHT,Player.WIDTH),requestAnimFrame(this.loop)):stop()},requestAnimFrame(this.loop)}}var NJ={entities:[],WIDTH:640,HEIGHT:960,RATIO:null,currentWidth:null,currentHeight:null,canvas:null,ctx:null,character:0,scale:1,offset:{top:0,left:0},init:function(){NJ.RATIO=NJ.WIDTH/NJ.HEIGHT,NJ.currentWidth=NJ.WIDTH,NJ.currentHeight=NJ.HEIGHT,NJ.canvas=document.getElementsByTagName("canvas")[0],NJ.canvas.width=NJ.WIDTH,NJ.canvas.height=NJ.HEIGHT,NJ.ctx=NJ.canvas.getContext("2d"),NJ.ctx.font="30px Arial",NJ.resize()},update:function(){gamma=tiltValue/2,updateSponge(),spongeUpBool?NJ.entities.forEach(function(t){t.isHit()}):NJ.entities.forEach(function(t){t.check()}),generatePlatforms()},render:function(){NJ.Draw.clear(),NJ.entities.forEach(function(t){t.draw()}),NJ.ctx.drawImage(Player.IMAGE,spongeX,spongeY,Player.HEIGHT,Player.WIDTH),NJ.ctx.fillText(parseInt(punktzahl)+" Punkte",10,30)},loop:function(){NJ.update(),NJ.render(),requestId=requestAnimFrame(NJ.loop),spongeY>960&&gameover()},resize:function(){NJ.currentHeight=window.innerHeight,NJ.currentWidth=NJ.currentHeight*NJ.RATIO,NJ.canvas.style.width=NJ.currentWidth+"px",NJ.canvas.style.height=NJ.currentHeight+"px",NJ.scale=NJ.currentWidth/NJ.WIDTH,NJ.offset.top=NJ.canvas.offsetTop,NJ.offset.left=NJ.canvas.offsetLeft}};NJ.Draw={clear:function(){NJ.ctx.clearRect(0,0,NJ.WIDTH,NJ.HEIGHT)},rect:function(t,e,n,i,r){NJ.ctx.fillStyle=r,NJ.ctx.fillRect(t,e,n,i)},circle:function(t,e,n,i){NJ.ctx.fillStyle=i,NJ.ctx.beginPath(),NJ.ctx.arc(t+5,e+5,n,0,2*Math.PI,!0),NJ.ctx.closePath(),NJ.ctx.fill()},text:function(t,e,n,i,r){NJ.ctx.font="bold "+i+"px Monospace",NJ.ctx.fillStyle=r,NJ.ctx.fillText(t,e,n)}};var SOUND={platformsound:new Audio("./sounds/sound1.mp3"),music:new Audio("./sounds/music0.wav"),tempsounds:0,initAudio:function(){var t=this;t.audio=SOUND.platformsound,t.audio2=SOUND.music,t.audio2.loop=!0;var e=function(){t.audio.play(),t.audio2.play(),document.removeEventListener("touchstart",t.startAudio,!1)};t.startAudio=e;var n=function(){t.audio.pause(),t.audio.removeEventListener("play",t.pauseAudio,!1)};t.pauseAudio=n,document.addEventListener("touchstart",t.startAudio,!1),t.audio.addEventListener("play",t.pauseAudio,!1)}};window.addEventListener("load",NJ.init,!1),window.addEventListener("resize",NJ.resize,!1);var currentScreen=null;sprungMax=40;var requestId;Player=new Object,Player.Scale=.5,Player.IMAGE=new Image,Player.IMAGE.src="./pictures/spongi0.png",Player.IMAGE.onload=function(){Player.WIDTH=Player.IMAGE.width*Player.Scale,Player.HEIGHT=Player.IMAGE.height*Player.Scale};var MenuButton=function(t,e,n,i){this.img=new Image,this.img.x1=t,this.img.y1=e,this.img.src=n,this.x1=t,this.y1=e,this.x2=t+200,this.y2=e+100,this.func=i;this.img;this.img.onload=function(){},this.draw=function(t){NJ.ctx.drawImage(this.img,this.img.x1,this.img.y1)},this.isHit=function(t,e){t=(t-NJ.offset.left)/NJ.scale,e=(e-NJ.offset.top)/NJ.scale,this.x1<t&&t<this.x2&&this.y1<e&&e<this.y2&&this.func()}},Gamescreen=function(){this.touchFunc=function(t){t.touches[0];alert("Shooting not implemented yet!")}},Menu=function(){currentScreen=this,gamescreen=new Gamescreen;var t=[],e=function(){return alert("Button clicked"),!0},n=new MenuButton(220,100,"./pictures/start.png",start),i=new MenuButton(220,250,"./pictures/highscore.png",e),r=new MenuButton(220,400,"./pictures/charakter.png",charselection),a=new MenuButton(220,800,"./pictures/fullscreen.png",toggleFullScreen);t.push(n,i,r,a),this.draw=function(){t.forEach(function(t){t.draw()})},this.touchFunc=function(e){var n=e.touches[0];t.forEach(function(t){t.isHit(n.pageX,n.pageY)},!1)}};menu=new Menu;var selectChar=function(t){currentScreen=menu,NJ.Draw.clear(),NJ.character=t,0==NJ.character?Player.IMAGE.src="./pictures/spongi0.png":Player.IMAGE.src="./pictures/spongi1.png",Player.IMAGE.onload=function(){Player.WIDTH=Player.IMAGE.width*Player.Scale,Player.HEIGHT=Player.IMAGE.height*Player.Scale},SOUND.music=new Audio("./sounds/music"+NJ.character+".wav"),SOUND.audio2=SOUND.music,SOUND.audio2.loop=!0,currentScreen.draw()},Chars=function(){currentScreen=this;var t=[],e=new MenuButton(150,400,"./pictures/spongi0.png",function(){selectChar(0)}),n=new MenuButton(300,400,"./pictures/spongi1.png",function(){selectChar(1)});e.x2=e.x1+160,e.y2=e.y1+200,n.x2=n.x1+160,n.y2=n.y1+200,t.push(e,n),this.draw=function(){t.forEach(function(t){t.draw()})},this.touchFunc=function(e){var n=e.touches[0];t.forEach(function(t){t.isHit(n.pageX,n.pageY)},!1)}};window.onload=function(){document.ontouchmove=function(t){t.preventDefault()},gamma=0,tiltValue=0,window.addEventListener("deviceorientation",function(t){tiltValue=t.gamma},!1),SOUND.initAudio(),currentScreen.draw()},window.addEventListener("touchstart",function(t){t.preventDefault(),currentScreen.touchFunc(t)}),window.onkeyup=function(t){var e=t.keyCode?t.keyCode:t.which;38==e&&start()};